<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Motion Example</title>
    <style>
        #box {
            width: 100px;
            height: 100px;
            background-color: rgb(26, 51, 119);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body>
    <div id="box"></div>
    <button onclick="initializeMotion()">Allow Motion Sensors</button>

    <script>
        let deviceOrientationListener;
        let deviceMotionListener;

        function initializeMotion() {
            // אם הדפדפן תומך בהרשאה (כמו ב-iOS), נבקש הרשאה
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            startDeviceOrientation();  // התחלת המעקב אחרי DeviceOrientation אם ההרשאה ניתנה
                        } else {
                            console.log("Permission denied for motion sensors.");
                        }
                    })
                    .catch(error => {
                        console.error("Error requesting permission:", error);
                    });
            } else {
                // אם הדפדפן לא דורש הרשאה, נתחיל את המעקב מיד
                startDeviceOrientation();
            }
        }

        // התחלת המעקב אחרי DeviceOrientation (כדי לקבוע את הכיוון)
        function startDeviceOrientation() {
            deviceOrientationListener = function (event) {
                let alpha = event.alpha;  // סיבוב סביב ציר Z (מצפן)
                let beta = event.beta;    // הטיית המכשיר סביב ציר X
                let gamma = event.gamma;  // הטיית המכשיר סביב ציר Y
                
                console.log("DeviceOrientation - alpha:", alpha, "beta:", beta, "gamma:", gamma);
                
                // ברגע שקבענו את הכיוון, נוכל לעבור ל-DeviceMotion
                stopDeviceOrientation();
                startDeviceMotion();
            };

            window.addEventListener("deviceorientation", deviceOrientationListener, true);
        }

        // הפסקת המעקב אחרי DeviceOrientation
        function stopDeviceOrientation() {
            if (deviceOrientationListener) {
                window.removeEventListener("deviceorientation", deviceOrientationListener, true);
                deviceOrientationListener = null;
                console.log("DeviceOrientation stopped");
            }
        }

        // התחלת המעקב אחרי DeviceMotion (לאחר קביעת הכיוון)
        function startDeviceMotion() {
            deviceMotionListener = function (event) {
                let accelX = event.acceleration.x;
                let accelY = event.acceleration.y;
                let accelZ = event.acceleration.z;
                let rotationRateAlpha = event.rotationRate.alpha;
                let rotationRateBeta = event.rotationRate.beta;
                let rotationRateGamma = event.rotationRate.gamma;
                
                console.log("DeviceMotion - AccelX:", accelX, "AccelY:", accelY, "AccelZ:", accelZ);
                console.log("DeviceMotion - RotationRate Alpha:", rotationRateAlpha, "Beta:", rotationRateBeta, "Gamma:", rotationRateGamma);
            };

            window.addEventListener('devicemotion', deviceMotionListener, true);
        }
    </script>
</body>
</html>
